//         Left: A B C N
//        Right: ROT1 ROT2 Pos

// A           : Phase A
// B           : Phase B
// C           : Phase C
// N           : Neutral
// ROT1        : Mechanical plus
// ROT2        : Mechanical minus
// Pos         : Position

MODELDEF Setup1
{
PORT electrical: A;
PORT electrical: B;
PORT electrical: C;
PORT electrical: N;
PORT ROTATIONAL_V: ROT1;
PORT ROTATIONAL_V: ROT2;
PORT REAL OUT ANGLE[deg]: Pos = VM_Pos.V;
PORT REAL IN ANGLE[deg]: IniPos = 0;

INTERN  R        Ra  N1:=A, N2:=N0_1  ( R:=14.9043 ); 
INTERN  R        Rb  N1:=B, N2:=N0_2  ( R:=14.9043 ); 
INTERN  R        Rc  N1:=C, N2:=N0_3  ( R:=14.9043 ); 
UMODEL Transformation_3To2 AB0 NAP:=N0_1, NAN:=N, NBP:=N0_2, NBN:=N, NCP:=N0_3, NCN:=N, NALPHA:=alpha, NBETA:=beta, NZERO:=zero () SRC: DLL( File:="Transformation.dll");

INTERN  EV       Speed  N1:=NM_1, N2:=GND  ( QUANT:=Torq.V, FACT:=1 ); 
INTERN  II       Torq  N1:=NM_6, N2:=NM_5  ( QUANT:=Speed.I, FACT:=1 ); 
UMODEL D2D D2D1 N1:=NM_5, N2:=ROT1 ( NATURE_1:="electrical", NATURE_2:="Rotational_V" ) SRC: DLL( File:="Domains.dll");
UMODEL D2D D2D2 N1:=NM_6, N2:=ROT2 ( NATURE_1:="electrical", NATURE_2:="Rotational_V" ) SRC: DLL( File:="Domains.dll");
INTERN  VM       VM_Pos  N1:=NM_2, N2:=GND  ; 
MODEL Setup1_AB0 model1 N_1:=alpha, N_2:=beta, N_3:=zero, N_4:=NM_1, N_5:=NM_2 ( pos0:=IniPos );


//         Left: N_1 N_2 N_3
//        Right: N_4 N_5

MODELDEF Setup1_AB0
{
PORT electrical: N_1;
PORT electrical: N_4;
PORT electrical: N_2;
PORT electrical: N_5;
PORT electrical: N_3;
PORT REAL IN: pos0 = 0;

INTERN  L        L1d  N1:=N_1, N2:=N_8  ( L:=N_41.V, I0:=0 ); 
INTERN  L        Lmd  N1:=N_8, N2:=GND  ( L:=N_43.V, I0:=0 ); 
INTERN  R        Rfed  N1:=N_8, N2:=GND  ( R:=4.24317e+007 ); 
INTERN  L        L2d  N1:=N_9, N2:=N_8  ( L:=N_42.V, I0:=0 ); 
INTERN  R        R2d  N1:=N_10, N2:=N_9  ( R:=0.233621 ); 
INTERN  E        B2d  N1:=N_10, N2:=N_11  ( EMF:=2 * N_42.V * N_4.V * L2q.I, PARTDERIV:=1 ); 
INTERN  L        L2td  N1:=N_12, N2:=N_11  ( L:=0.00191985, I0:=0 ); 
INTERN  L        L2bd  N1:=N_13, N2:=N_11  ( L:=0.00506966, I0:=0 ); 
INTERN  M        K2d  ( L1:= L2td.L, L2:= L2bd.L, K:=0.736783 ); 
INTERN  R        R2td  N1:=N_14, N2:=N_12  ( R:=4.53242 ); 
INTERN  R        R2bd  N1:=N_15, N2:=N_13  ( R:=1.94246 ); 
INTERN  E        B2ttd  N1:=N_14, N2:=N_16  ( EMF:=0.0038397 * N_4.V * L2tq.I, PARTDERIV:=1 ); 
INTERN  E        B2btd  N1:=N_15, N2:=N_17  ( EMF:=0.00459719 * N_4.V * L2tq.I, PARTDERIV:=1 ); 
INTERN  E        B2tbd  N1:=N_16, N2:=N_18  ( EMF:=0.00459719 * N_4.V * L2bq.I, PARTDERIV:=1 ); 
INTERN  E        B2bbd  N1:=N_17, N2:=N_18  ( EMF:=0.0101393 * N_4.V * L2bq.I, PARTDERIV:=1 ); 
INTERN  E        Bmd  N1:=N_18, N2:=GND  ( EMF:=2 * N_43.V * N_4.V * Lmq.I, PARTDERIV:=1 ); 
INTERN  L        L1q  N1:=N_2, N2:=N_28  ( L:=N_41.V, I0:=0 ); 
INTERN  L        Lmq  N1:=N_28, N2:=GND  ( L:=N_43.V, I0:=0 ); 
INTERN  R        Rfeq  N1:=N_28, N2:=GND  ( R:=4.24317e+007 ); 
INTERN  L        L2q  N1:=N_29, N2:=N_28  ( L:=N_42.V, I0:=0 ); 
INTERN  R        R2q  N1:=N_30, N2:=N_29  ( R:=0.233621 ); 
INTERN  E        B2q  N1:=N_30, N2:=N_31  ( EMF:=-2 * N_42.V * N_4.V * L2d.I, PARTDERIV:=1 ); 
INTERN  L        L2tq  N1:=N_32, N2:=N_31  ( L:=0.00191985, I0:=0 ); 
INTERN  L        L2bq  N1:=N_33, N2:=N_31  ( L:=0.00506966, I0:=0 ); 
INTERN  M        K2q  ( L1:= L2tq.L, L2:= L2bq.L, K:=0.736783 ); 
INTERN  R        R2tq  N1:=N_34, N2:=N_32  ( R:=4.53242 ); 
INTERN  R        R2bq  N1:=N_35, N2:=N_33  ( R:=1.94246 ); 
INTERN  E        B2ttq  N1:=N_34, N2:=N_36  ( EMF:=-0.0038397 * N_4.V * L2td.I, PARTDERIV:=1 ); 
INTERN  E        B2btq  N1:=N_35, N2:=N_37  ( EMF:=-0.00459719 * N_4.V * L2td.I, PARTDERIV:=1 ); 
INTERN  E        B2tbq  N1:=N_36, N2:=N_38  ( EMF:=-0.00459719 * N_4.V * L2bd.I, PARTDERIV:=1 ); 
INTERN  E        B2bbq  N1:=N_37, N2:=N_38  ( EMF:=-0.0101393 * N_4.V * L2bd.I, PARTDERIV:=1 ); 
INTERN  E        Bmq  N1:=N_38, N2:=GND  ( EMF:=-2 * N_43.V * N_4.V * Lmd.I, PARTDERIV:=1 ); 
INTERN  L        L0  N1:=N_3, N2:=GND  ( L:=0.00506543, I0:=0 ); 
INTERN  I        BT  N1:=GND, N2:=N_4  ( IS:=2 * N_43.V * (L2d.I*Lmq.I - L2q.I*Lmd.I), PARTDERIV:=1 ); 
INTERN  VM       VM_Speed  N1:=N_4, N2:=GND  ; 
INTERN  IV       Gx  N1:=GND, N2:=N_55  ( QUANT:=VM_Speed.V, FACT:=1 ); 
INTERN  C        Cx  N1:=N_55, N2:=GND  ( C:=1, V0:=pos0*0.0174533 ); 
INTERN  VM       VM_Pos  N1:=N_55, N2:=GND  ; 
INTERN  EV       Ex2  N1:=GND, N2:=N_5  ( QUANT:=VM_Pos.V, FACT:=57.2958 ); 
INTERN  E        BIsr  N1:=GND, N2:=N_39  ( EMF:=sqrt(L1d.I*L1d.I + L1q.I*L1q.I), PARTDERIV:=1 ); 
INTERN  VM       VM_Isr  N1:=N_39, N2:=GND  ; 
INTERN  E        BIm  N1:=GND, N2:=N_40  ( EMF:=sqrt(Lmd.I*Lmd.I + Lmq.I*Lmq.I), PARTDERIV:=1 ); 
INTERN  VM       VM_Im  N1:=N_40, N2:=GND  ; 
INTERN  VM       VM_L1  N1:=N_41, N2:=GND  ; 
INTERN  NDSRC    PL1 N0:=N_41, N1:=GND  ( QUANT:={N_39.V}, SRC:={vsrc}, TableData:="\
.MODEL Setup1_l1_table pwl TABLE=( 51, 0, 0.591643, 1.18329, 1.77493, 2.36657,\
 2.95821, 3.54986, 4.1415, 4.73314, 5.32478, 5.91643, 6.50807, 7.09971,\
 7.69136, 8.283, 8.87464, 9.46628, 10.0579, 10.6496, 11.2412, 11.8329, 12.4245,\
 13.0161, 13.6078, 14.1994, 14.7911, 15.3827, 15.9744, 16.566, 17.1576,\
 17.7493, 18.3409, 18.9326, 19.5242, 20.1159, 20.7075, 21.2991, 21.8908,\
 22.4824, 23.0741, 23.6657, 24.2574, 24.849, 25.4406, 26.0323, 26.6239,\
 27.2156, 27.8072, 28.3989, 28.9905, 29.5821, 1, 0.00508068, 0.00507988,\
 0.00507908, 0.00507828, 0.00507749, 0.00507669, 0.0050759, 0.0050751,\
 0.00507431, 0.00507352, 0.00507273, 0.00507194, 0.00507103, 0.00506946,\
 0.00506789, 0.00506632, 0.00506476, 0.0050632, 0.00506165, 0.0050601,\
 0.00505855, 0.00505701, 0.00505547, 0.00505394, 0.0050518, 0.0050483,\
 0.00504481, 0.00504135, 0.0050379, 0.00503447, 0.00503107, 0.00502767,\
 0.0050243, 0.00502095, 0.00501761, 0.00501429, 0.0050086, 0.0050001,\
 0.0049911, 0.00497569, 0.00496065, 0.00494596, 0.0049316, 0.00491755,\
 0.00490381, 0.00489036, 0.00487719, 0.00486427, 0.00485262, 0.00484183,\
 0.00483121) CONSTANT NOSPLINE" );
INTERN  VM       VM_L2  N1:=N_42, N2:=GND  ; 
INTERN  NDSRC    PL2 N0:=N_42, N1:=GND  ( QUANT:={N_39.V}, SRC:={vsrc}, TableData:="\
.MODEL Setup1_l2_table pwl TABLE=( 51, 0, 0.591643, 1.18329, 1.77493, 2.36657,\
 2.95821, 3.54986, 4.1415, 4.73314, 5.32478, 5.91643, 6.50807, 7.09971,\
 7.69136, 8.283, 8.87464, 9.46628, 10.0579, 10.6496, 11.2412, 11.8329, 12.4245,\
 13.0161, 13.6078, 14.1994, 14.7911, 15.3827, 15.9744, 16.566, 17.1576,\
 17.7493, 18.3409, 18.9326, 19.5242, 20.1159, 20.7075, 21.2991, 21.8908,\
 22.4824, 23.0741, 23.6657, 24.2574, 24.849, 25.4406, 26.0323, 26.6239,\
 27.2156, 27.8072, 28.3989, 28.9905, 29.5821, 1, 0.00425647, 0.00425303,\
 0.0042496, 0.00424617, 0.00424276, 0.00423934, 0.00423594, 0.00423255,\
 0.00422916, 0.00422578, 0.00422241, 0.00421904, 0.00421518, 0.00420849,\
 0.00420183, 0.00419519, 0.00418859, 0.00418201, 0.00417547, 0.00416895,\
 0.00416245, 0.00415599, 0.00414955, 0.00414314, 0.00413425, 0.00411969,\
 0.00410526, 0.00409096, 0.00407679, 0.00406274, 0.00404882, 0.00403502,\
 0.00402134, 0.00400777, 0.00399432, 0.00398097, 0.00395815, 0.00392431,\
 0.00388873, 0.00382831, 0.00376992, 0.00371337, 0.0036585, 0.00360518,\
 0.00355327, 0.00350267, 0.00345326, 0.00340496, 0.00336146, 0.0033212,\
 0.00328162) CONSTANT NOSPLINE" );
INTERN  VM       VM_Lm  N1:=N_43, N2:=GND  ; 
INTERN  NDSRC    PLm N0:=N_43, N1:=GND  ( QUANT:={N_40.V}, SRC:={vsrc}, TableData:="\
.MODEL Setup1_lm_table pwl TABLE=( 51, 0, 0.15845, 0.316899, 0.475349,\
 0.622413, 0.75297, 0.878364, 1.00139, 1.13118, 1.26263, 1.39396, 1.52365,\
 1.65236, 1.7828, 1.91878, 2.06105, 2.22056, 2.38012, 2.56503, 2.73555,\
 2.89754, 3.06807, 3.26388, 3.50275, 3.77141, 4.07452, 4.41229, 4.80221,\
 5.32692, 6.14279, 7.53483, 9.2582, 11.804, 14.7452, 19.5922, 26.7063, 35.4576,\
 43.5261, 50.4857, 58.2789, 66.567, 102.085, 140.569, 180.79, 221.059, 261.382,\
 301.684, 341.956, 382.224, 422.524, 462.877, 1, 0.190846, 0.190846, 0.190846,\
 0.190846, 0.194337, 0.200801, 0.206562, 0.211382, 0.213862, 0.215546,\
 0.216932, 0.218314, 0.219608, 0.220502, 0.220637, 0.220078, 0.217887,\
 0.215985, 0.212204, 0.21003, 0.208725, 0.20698, 0.203827, 0.19856, 0.192434,\
 0.18554, 0.17819, 0.170019, 0.158948, 0.14276, 0.120399, 0.101253, 0.0819773,\
 0.0676763, 0.0524771, 0.0396304, 0.030702, 0.0257055, 0.0227609, 0.0202361,\
 0.0181708, 0.0130336, 0.0103258, 0.00869765, 0.00766044, 0.00694144,\
 0.00641507, 0.00601329, 0.00569624, 0.00543921, 0.00522634) CONSTANT NOSPLINE" );
}

}
