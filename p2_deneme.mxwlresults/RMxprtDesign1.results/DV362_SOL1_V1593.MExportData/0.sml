//         Left: A B C N
//        Right: ROT1 ROT2 Pos

// A           : Phase A
// B           : Phase B
// C           : Phase C
// N           : Neutral
// ROT1        : Mechanical plus
// ROT2        : Mechanical minus
// Pos         : Position

MODELDEF Setup1
{
PORT electrical: A;
PORT electrical: B;
PORT electrical: C;
PORT electrical: N;
PORT ROTATIONAL_V: ROT1;
PORT ROTATIONAL_V: ROT2;
PORT REAL OUT ANGLE[deg]: Pos = VM_Pos.V;
PORT REAL IN ANGLE[deg]: IniPos = 0;

INTERN  R        Ra  N1:=A, N2:=N0_1  ( R:=4.26235 ); 
INTERN  R        Rb  N1:=B, N2:=N0_2  ( R:=4.26235 ); 
INTERN  R        Rc  N1:=C, N2:=N0_3  ( R:=4.26235 ); 
UMODEL Transformation_3To2 AB0 NAP:=N0_1, NAN:=N, NBP:=N0_2, NBN:=N, NCP:=N0_3, NCN:=N, NALPHA:=alpha, NBETA:=beta, NZERO:=zero () SRC: DLL( File:="Transformation.dll");

INTERN  EV       Speed  N1:=NM_1, N2:=GND  ( QUANT:=Torq.V, FACT:=1 ); 
INTERN  II       Torq  N1:=NM_6, N2:=NM_5  ( QUANT:=Speed.I, FACT:=1 ); 
UMODEL D2D D2D1 N1:=NM_5, N2:=ROT1 ( NATURE_1:="electrical", NATURE_2:="Rotational_V" ) SRC: DLL( File:="Domains.dll");
UMODEL D2D D2D2 N1:=NM_6, N2:=ROT2 ( NATURE_1:="electrical", NATURE_2:="Rotational_V" ) SRC: DLL( File:="Domains.dll");
INTERN  VM       VM_Pos  N1:=NM_2, N2:=GND  ; 
MODEL Setup1_AB0 model1 N_1:=alpha, N_2:=beta, N_3:=zero, N_4:=NM_1, N_5:=NM_2 ( pos0:=IniPos );


//         Left: N_1 N_2 N_3
//        Right: N_4 N_5

MODELDEF Setup1_AB0
{
PORT electrical: N_1;
PORT electrical: N_4;
PORT electrical: N_2;
PORT electrical: N_5;
PORT electrical: N_3;
PORT REAL IN: pos0 = 0;

INTERN  L        L1d  N1:=N_1, N2:=N_8  ( L:=N_41.V, I0:=0 ); 
INTERN  L        Lmd  N1:=N_8, N2:=GND  ( L:=N_43.V, I0:=0 ); 
INTERN  R        Rfed  N1:=N_8, N2:=GND  ( R:=8.62519e+007 ); 
INTERN  L        L2d  N1:=N_9, N2:=N_8  ( L:=N_42.V, I0:=0 ); 
INTERN  R        R2d  N1:=N_10, N2:=N_9  ( R:=0.847083 ); 
INTERN  E        B2d  N1:=N_10, N2:=N_11  ( EMF:=2 * N_42.V * N_4.V * L2q.I, PARTDERIV:=1 ); 
INTERN  L        L2td  N1:=N_12, N2:=N_11  ( L:=0.00399836, I0:=0 ); 
INTERN  L        L2bd  N1:=N_13, N2:=N_11  ( L:=0.0105583, I0:=0 ); 
INTERN  M        K2d  ( L1:= L2td.L, L2:= L2bd.L, K:=0.736783 ); 
INTERN  R        R2td  N1:=N_14, N2:=N_12  ( R:=9.64133 ); 
INTERN  R        R2bd  N1:=N_15, N2:=N_13  ( R:=4.13198 ); 
INTERN  E        B2ttd  N1:=N_14, N2:=N_16  ( EMF:=0.00799673 * N_4.V * L2tq.I, PARTDERIV:=1 ); 
INTERN  E        B2btd  N1:=N_15, N2:=N_17  ( EMF:=0.00957432 * N_4.V * L2tq.I, PARTDERIV:=1 ); 
INTERN  E        B2tbd  N1:=N_16, N2:=N_18  ( EMF:=0.00957432 * N_4.V * L2bq.I, PARTDERIV:=1 ); 
INTERN  E        B2bbd  N1:=N_17, N2:=N_18  ( EMF:=0.0211166 * N_4.V * L2bq.I, PARTDERIV:=1 ); 
INTERN  E        Bmd  N1:=N_18, N2:=GND  ( EMF:=2 * N_43.V * N_4.V * Lmq.I, PARTDERIV:=1 ); 
INTERN  L        L1q  N1:=N_2, N2:=N_28  ( L:=N_41.V, I0:=0 ); 
INTERN  L        Lmq  N1:=N_28, N2:=GND  ( L:=N_43.V, I0:=0 ); 
INTERN  R        Rfeq  N1:=N_28, N2:=GND  ( R:=8.62519e+007 ); 
INTERN  L        L2q  N1:=N_29, N2:=N_28  ( L:=N_42.V, I0:=0 ); 
INTERN  R        R2q  N1:=N_30, N2:=N_29  ( R:=0.847083 ); 
INTERN  E        B2q  N1:=N_30, N2:=N_31  ( EMF:=-2 * N_42.V * N_4.V * L2d.I, PARTDERIV:=1 ); 
INTERN  L        L2tq  N1:=N_32, N2:=N_31  ( L:=0.00399836, I0:=0 ); 
INTERN  L        L2bq  N1:=N_33, N2:=N_31  ( L:=0.0105583, I0:=0 ); 
INTERN  M        K2q  ( L1:= L2tq.L, L2:= L2bq.L, K:=0.736783 ); 
INTERN  R        R2tq  N1:=N_34, N2:=N_32  ( R:=9.64133 ); 
INTERN  R        R2bq  N1:=N_35, N2:=N_33  ( R:=4.13198 ); 
INTERN  E        B2ttq  N1:=N_34, N2:=N_36  ( EMF:=-0.00799673 * N_4.V * L2td.I, PARTDERIV:=1 ); 
INTERN  E        B2btq  N1:=N_35, N2:=N_37  ( EMF:=-0.00957432 * N_4.V * L2td.I, PARTDERIV:=1 ); 
INTERN  E        B2tbq  N1:=N_36, N2:=N_38  ( EMF:=-0.00957432 * N_4.V * L2bd.I, PARTDERIV:=1 ); 
INTERN  E        B2bbq  N1:=N_37, N2:=N_38  ( EMF:=-0.0211166 * N_4.V * L2bd.I, PARTDERIV:=1 ); 
INTERN  E        Bmq  N1:=N_38, N2:=GND  ( EMF:=-2 * N_43.V * N_4.V * Lmd.I, PARTDERIV:=1 ); 
INTERN  L        L0  N1:=N_3, N2:=GND  ( L:=0.00949275, I0:=0 ); 
INTERN  I        BT  N1:=GND, N2:=N_4  ( IS:=2 * N_43.V * (L2d.I*Lmq.I - L2q.I*Lmd.I), PARTDERIV:=1 ); 
INTERN  VM       VM_Speed  N1:=N_4, N2:=GND  ; 
INTERN  IV       Gx  N1:=GND, N2:=N_55  ( QUANT:=VM_Speed.V, FACT:=1 ); 
INTERN  C        Cx  N1:=N_55, N2:=GND  ( C:=1, V0:=pos0*0.0174533 ); 
INTERN  VM       VM_Pos  N1:=N_55, N2:=GND  ; 
INTERN  EV       Ex2  N1:=GND, N2:=N_5  ( QUANT:=VM_Pos.V, FACT:=57.2958 ); 
INTERN  E        BIsr  N1:=GND, N2:=N_39  ( EMF:=sqrt(L1d.I*L1d.I + L1q.I*L1q.I), PARTDERIV:=1 ); 
INTERN  VM       VM_Isr  N1:=N_39, N2:=GND  ; 
INTERN  E        BIm  N1:=GND, N2:=N_40  ( EMF:=sqrt(Lmd.I*Lmd.I + Lmq.I*Lmq.I), PARTDERIV:=1 ); 
INTERN  VM       VM_Im  N1:=N_40, N2:=GND  ; 
INTERN  VM       VM_L1  N1:=N_41, N2:=GND  ; 
INTERN  NDSRC    PL1 N0:=N_41, N1:=GND  ( QUANT:={N_39.V}, SRC:={vsrc}, TableData:="\
.MODEL Setup1_l1_table pwl TABLE=( 51, 0, 1.29825, 2.59651, 3.89476, 5.19302,\
 6.49127, 7.78953, 9.08778, 10.386, 11.6843, 12.9825, 14.2808, 15.5791,\
 16.8773, 18.1756, 19.4738, 20.7721, 22.0703, 23.3686, 24.6668, 25.9651,\
 27.2634, 28.5616, 29.8599, 31.1581, 32.4564, 33.7546, 35.0529, 36.3511,\
 37.6494, 38.9476, 40.2459, 41.5442, 42.8424, 44.1407, 45.4389, 46.7372,\
 48.0354, 49.3337, 50.6319, 51.9302, 53.2284, 54.5267, 55.825, 57.1232,\
 58.4215, 59.7197, 61.018, 62.3162, 63.6145, 64.9127, 1, 0.00951956,\
 0.00951657, 0.00951358, 0.00951061, 0.00950764, 0.00950468, 0.00950106,\
 0.00949519, 0.00948935, 0.00948355, 0.00947778, 0.00947205, 0.00946298,\
 0.00945004, 0.00943726, 0.00942465, 0.00941219, 0.0093999, 0.00937457,\
 0.00933017, 0.00927614, 0.00922503, 0.00917656, 0.00913049, 0.00909183,\
 0.00905522, 0.00902002, 0.00898612, 0.00895343, 0.00892187, 0.00889137,\
 0.00886185, 0.00883326, 0.00880553, 0.00877861, 0.00875489, 0.00873586,\
 0.00871721, 0.00869892, 0.00868099, 0.00866339, 0.00864611, 0.00862914,\
 0.00861246, 0.00859607, 0.00857996, 0.0085641, 0.00855282, 0.00854258,\
 0.00853244, 0.00852241) CONSTANT NOSPLINE" );
INTERN  VM       VM_L2  N1:=N_42, N2:=GND  ; 
INTERN  NDSRC    PL2 N0:=N_42, N1:=GND  ( QUANT:={N_39.V}, SRC:={vsrc}, TableData:="\
.MODEL Setup1_l2_table pwl TABLE=( 51, 0, 1.29825, 2.59651, 3.89476, 5.19302,\
 6.49127, 7.78953, 9.08778, 10.386, 11.6843, 12.9825, 14.2808, 15.5791,\
 16.8773, 18.1756, 19.4738, 20.7721, 22.0703, 23.3686, 24.6668, 25.9651,\
 27.2634, 28.5616, 29.8599, 31.1581, 32.4564, 33.7546, 35.0529, 36.3511,\
 37.6494, 38.9476, 40.2459, 41.5442, 42.8424, 44.1407, 45.4389, 46.7372,\
 48.0354, 49.3337, 50.6319, 51.9302, 53.2284, 54.5267, 55.825, 57.1232,\
 58.4215, 59.7197, 61.018, 62.3162, 63.6145, 64.9127, 1, 0.00595937,\
 0.00594735, 0.0059354, 0.00592352, 0.00591171, 0.00589996, 0.00588562,\
 0.00586247, 0.00583957, 0.00581692, 0.00579451, 0.00577234, 0.0057375,\
 0.00568818, 0.00563999, 0.00559288, 0.00554681, 0.00550172, 0.00541005,\
 0.00525299, 0.00506733, 0.00489636, 0.0047377, 0.00458944, 0.00446657,\
 0.00435122, 0.00424101, 0.00413535, 0.00403375, 0.00393578, 0.00384107,\
 0.0037493, 0.00366018, 0.00357347, 0.00348895, 0.00341414, 0.00335386,\
 0.00329453, 0.0032361, 0.00317852, 0.00312173, 0.0030657, 0.00301037,\
 0.00295571, 0.00290168, 0.00284825, 0.00279538, 0.00275757, 0.00272312,\
 0.00268888, 0.00265486) CONSTANT NOSPLINE" );
INTERN  VM       VM_Lm  N1:=N_43, N2:=GND  ; 
INTERN  NDSRC    PLm N0:=N_43, N1:=GND  ( QUANT:={N_40.V}, SRC:={vsrc}, TableData:="\
.MODEL Setup1_lm_table pwl TABLE=( 51, 0, 0.101878, 0.203757, 0.305635,\
 0.405425, 0.494972, 0.582047, 0.667525, 0.753564, 0.842605, 0.93274, 1.02154,\
 1.10964, 1.19769, 1.28721, 1.3786, 1.47074, 1.57342, 1.67607, 1.78355,\
 1.89639, 2.00588, 2.11872, 2.23758, 2.36448, 2.51116, 2.65951, 2.8379,\
 3.04952, 3.26915, 3.51143, 3.83124, 4.29494, 4.99011, 5.83288, 7.24693,\
 8.62737, 11.2444, 14.7255, 18.9736, 23.2405, 38.5369, 56.1331, 75.0063,\
 94.5072, 113.996, 133.513, 153.012, 172.494, 191.961, 211.441, 1, 0.296819,\
 0.296819, 0.296819, 0.296819, 0.298348, 0.305466, 0.311721, 0.317106,\
 0.321028, 0.322992, 0.3242, 0.325621, 0.327019, 0.328225, 0.328891, 0.329024,\
 0.328971, 0.326722, 0.324754, 0.322138, 0.318916, 0.316584, 0.313994, 0.31083,\
 0.306937, 0.301051, 0.295628, 0.2877, 0.277652, 0.268248, 0.258352, 0.244679,\
 0.225303, 0.199976, 0.176266, 0.146045, 0.126182, 0.0995035, 0.0780347,\
 0.0621567, 0.0520461, 0.0345263, 0.0258581, 0.0209643, 0.0179183, 0.015916,\
 0.0144954, 0.0134387, 0.0126221, 0.0119722, 0.0114413) CONSTANT NOSPLINE" );
}

}
