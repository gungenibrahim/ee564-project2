//         Left: A B C N
//        Right: ROT1 ROT2 Pos

// A           : Phase A
// B           : Phase B
// C           : Phase C
// N           : Neutral
// ROT1        : Mechanical plus
// ROT2        : Mechanical minus
// Pos         : Position

MODELDEF Setup1
{
PORT electrical: A;
PORT electrical: B;
PORT electrical: C;
PORT electrical: N;
PORT ROTATIONAL_V: ROT1;
PORT ROTATIONAL_V: ROT2;
PORT REAL OUT ANGLE[deg]: Pos = VM_Pos.V;
PORT REAL IN ANGLE[deg]: IniPos = 0;

INTERN  R        Ra  N1:=A, N2:=N0_1  ( R:=20.4799 ); 
INTERN  R        Rb  N1:=B, N2:=N0_2  ( R:=20.4799 ); 
INTERN  R        Rc  N1:=C, N2:=N0_3  ( R:=20.4799 ); 
UMODEL Transformation_3To2 AB0 NAP:=N0_1, NAN:=N, NBP:=N0_2, NBN:=N, NCP:=N0_3, NCN:=N, NALPHA:=alpha, NBETA:=beta, NZERO:=zero () SRC: DLL( File:="Transformation.dll");

INTERN  EV       Speed  N1:=NM_1, N2:=GND  ( QUANT:=Torq.V, FACT:=1 ); 
INTERN  II       Torq  N1:=NM_6, N2:=NM_5  ( QUANT:=Speed.I, FACT:=1 ); 
UMODEL D2D D2D1 N1:=NM_5, N2:=ROT1 ( NATURE_1:="electrical", NATURE_2:="Rotational_V" ) SRC: DLL( File:="Domains.dll");
UMODEL D2D D2D2 N1:=NM_6, N2:=ROT2 ( NATURE_1:="electrical", NATURE_2:="Rotational_V" ) SRC: DLL( File:="Domains.dll");
INTERN  VM       VM_Pos  N1:=NM_2, N2:=GND  ; 
MODEL Setup1_AB0 model1 N_1:=alpha, N_2:=beta, N_3:=zero, N_4:=NM_1, N_5:=NM_2 ( pos0:=IniPos );


//         Left: N_1 N_2 N_3
//        Right: N_4 N_5

MODELDEF Setup1_AB0
{
PORT electrical: N_1;
PORT electrical: N_4;
PORT electrical: N_2;
PORT electrical: N_5;
PORT electrical: N_3;
PORT REAL IN: pos0 = 0;

INTERN  L        L1d  N1:=N_1, N2:=N_8  ( L:=N_41.V, I0:=0 ); 
INTERN  L        Lmd  N1:=N_8, N2:=GND  ( L:=N_43.V, I0:=0 ); 
INTERN  R        Rfed  N1:=N_8, N2:=GND  ( R:=6.61234e+007 ); 
INTERN  L        L2d  N1:=N_9, N2:=N_8  ( L:=N_42.V, I0:=0 ); 
INTERN  R        R2d  N1:=N_10, N2:=N_9  ( R:=0.491969 ); 
INTERN  E        B2d  N1:=N_10, N2:=N_11  ( EMF:=2 * N_42.V * N_4.V * L2q.I, PARTDERIV:=1 ); 
INTERN  L        L2td  N1:=N_12, N2:=N_11  ( L:=0.00288778, I0:=0 ); 
INTERN  L        L2bd  N1:=N_13, N2:=N_11  ( L:=0.00762564, I0:=0 ); 
INTERN  M        K2d  ( L1:= L2td.L, L2:= L2bd.L, K:=0.736783 ); 
INTERN  R        R2td  N1:=N_14, N2:=N_12  ( R:=6.89506 ); 
INTERN  R        R2bd  N1:=N_15, N2:=N_13  ( R:=2.95502 ); 
INTERN  E        B2ttd  N1:=N_14, N2:=N_16  ( EMF:=0.00577557 * N_4.V * L2tq.I, PARTDERIV:=1 ); 
INTERN  E        B2btd  N1:=N_15, N2:=N_17  ( EMF:=0.00691497 * N_4.V * L2tq.I, PARTDERIV:=1 ); 
INTERN  E        B2tbd  N1:=N_16, N2:=N_18  ( EMF:=0.00691497 * N_4.V * L2bq.I, PARTDERIV:=1 ); 
INTERN  E        B2bbd  N1:=N_17, N2:=N_18  ( EMF:=0.0152513 * N_4.V * L2bq.I, PARTDERIV:=1 ); 
INTERN  E        Bmd  N1:=N_18, N2:=GND  ( EMF:=2 * N_43.V * N_4.V * Lmq.I, PARTDERIV:=1 ); 
INTERN  L        L1q  N1:=N_2, N2:=N_28  ( L:=N_41.V, I0:=0 ); 
INTERN  L        Lmq  N1:=N_28, N2:=GND  ( L:=N_43.V, I0:=0 ); 
INTERN  R        Rfeq  N1:=N_28, N2:=GND  ( R:=6.61234e+007 ); 
INTERN  L        L2q  N1:=N_29, N2:=N_28  ( L:=N_42.V, I0:=0 ); 
INTERN  R        R2q  N1:=N_30, N2:=N_29  ( R:=0.491969 ); 
INTERN  E        B2q  N1:=N_30, N2:=N_31  ( EMF:=-2 * N_42.V * N_4.V * L2d.I, PARTDERIV:=1 ); 
INTERN  L        L2tq  N1:=N_32, N2:=N_31  ( L:=0.00288778, I0:=0 ); 
INTERN  L        L2bq  N1:=N_33, N2:=N_31  ( L:=0.00762564, I0:=0 ); 
INTERN  M        K2q  ( L1:= L2tq.L, L2:= L2bq.L, K:=0.736783 ); 
INTERN  R        R2tq  N1:=N_34, N2:=N_32  ( R:=6.89506 ); 
INTERN  R        R2bq  N1:=N_35, N2:=N_33  ( R:=2.95502 ); 
INTERN  E        B2ttq  N1:=N_34, N2:=N_36  ( EMF:=-0.00577557 * N_4.V * L2td.I, PARTDERIV:=1 ); 
INTERN  E        B2btq  N1:=N_35, N2:=N_37  ( EMF:=-0.00691497 * N_4.V * L2td.I, PARTDERIV:=1 ); 
INTERN  E        B2tbq  N1:=N_36, N2:=N_38  ( EMF:=-0.00691497 * N_4.V * L2bd.I, PARTDERIV:=1 ); 
INTERN  E        B2bbq  N1:=N_37, N2:=N_38  ( EMF:=-0.0152513 * N_4.V * L2bd.I, PARTDERIV:=1 ); 
INTERN  E        Bmq  N1:=N_38, N2:=GND  ( EMF:=-2 * N_43.V * N_4.V * Lmd.I, PARTDERIV:=1 ); 
INTERN  L        L0  N1:=N_3, N2:=GND  ( L:=0.00952241, I0:=0 ); 
INTERN  I        BT  N1:=GND, N2:=N_4  ( IS:=2 * N_43.V * (L2d.I*Lmq.I - L2q.I*Lmd.I), PARTDERIV:=1 ); 
INTERN  VM       VM_Speed  N1:=N_4, N2:=GND  ; 
INTERN  IV       Gx  N1:=GND, N2:=N_55  ( QUANT:=VM_Speed.V, FACT:=1 ); 
INTERN  C        Cx  N1:=N_55, N2:=GND  ( C:=1, V0:=pos0*0.0174533 ); 
INTERN  VM       VM_Pos  N1:=N_55, N2:=GND  ; 
INTERN  EV       Ex2  N1:=GND, N2:=N_5  ( QUANT:=VM_Pos.V, FACT:=57.2958 ); 
INTERN  E        BIsr  N1:=GND, N2:=N_39  ( EMF:=sqrt(L1d.I*L1d.I + L1q.I*L1q.I), PARTDERIV:=1 ); 
INTERN  VM       VM_Isr  N1:=N_39, N2:=GND  ; 
INTERN  E        BIm  N1:=GND, N2:=N_40  ( EMF:=sqrt(Lmd.I*Lmd.I + Lmq.I*Lmq.I), PARTDERIV:=1 ); 
INTERN  VM       VM_Im  N1:=N_40, N2:=GND  ; 
INTERN  VM       VM_L1  N1:=N_41, N2:=GND  ; 
INTERN  NDSRC    PL1 N0:=N_41, N1:=GND  ( QUANT:={N_39.V}, SRC:={vsrc}, TableData:="\
.MODEL Setup1_l1_table pwl TABLE=( 51, 0, 0.421166, 0.842332, 1.2635, 1.68466,\
 2.10583, 2.527, 2.94816, 3.36933, 3.7905, 4.21166, 4.63283, 5.05399, 5.47516,\
 5.89633, 6.31749, 6.73866, 7.15983, 7.58099, 8.00216, 8.42332, 8.84449,\
 9.26566, 9.68682, 10.108, 10.5292, 10.9503, 11.3715, 11.7927, 12.2138, 12.635,\
 13.0562, 13.4773, 13.8985, 14.3197, 14.7408, 15.162, 15.5831, 16.0043,\
 16.4255, 16.8466, 17.2678, 17.689, 18.1101, 18.5313, 18.9525, 19.3736,\
 19.7948, 20.216, 20.6371, 21.0583, 1, 0.00955576, 0.0095538, 0.00955183,\
 0.00954987, 0.00954791, 0.00954595, 0.00954399, 0.00954204, 0.00954009,\
 0.00953814, 0.00953619, 0.00953302, 0.00952914, 0.00952527, 0.00952141,\
 0.00951756, 0.00951371, 0.00950988, 0.00950605, 0.00950224, 0.00949843,\
 0.00949335, 0.00948465, 0.009476, 0.00946739, 0.00945882, 0.0094503,\
 0.00944182, 0.00943338, 0.00942498, 0.00941663, 0.00940832, 0.00938828,\
 0.00936703, 0.00933122, 0.00929284, 0.00925527, 0.00921847, 0.00918239,\
 0.00914699, 0.00911225, 0.00907812, 0.00904688, 0.00901823, 0.00898998,\
 0.00896211, 0.00893462, 0.00890747, 0.00888067, 0.00885419, 0.00882803)\
 CONSTANT NOSPLINE" );
INTERN  VM       VM_L2  N1:=N_42, N2:=GND  ; 
INTERN  NDSRC    PL2 N0:=N_42, N1:=GND  ( QUANT:={N_39.V}, SRC:={vsrc}, TableData:="\
.MODEL Setup1_l2_table pwl TABLE=( 51, 0, 0.421166, 0.842332, 1.2635, 1.68466,\
 2.10583, 2.527, 2.94816, 3.36933, 3.7905, 4.21166, 4.63283, 5.05399, 5.47516,\
 5.89633, 6.31749, 6.73866, 7.15983, 7.58099, 8.00216, 8.42332, 8.84449,\
 9.26566, 9.68682, 10.108, 10.5292, 10.9503, 11.3715, 11.7927, 12.2138, 12.635,\
 13.0562, 13.4773, 13.8985, 14.3197, 14.7408, 15.162, 15.5831, 16.0043,\
 16.4255, 16.8466, 17.2678, 17.689, 18.1101, 18.5313, 18.9525, 19.3736,\
 19.7948, 20.216, 20.6371, 21.0583, 1, 0.00775323, 0.00774669, 0.00774017,\
 0.00773365, 0.00772716, 0.00772068, 0.00771421, 0.00770776, 0.00770133,\
 0.00769491, 0.0076885, 0.00767809, 0.00766537, 0.00765271, 0.0076401,\
 0.00762755, 0.00761505, 0.00760261, 0.00759022, 0.00757788, 0.0075656,\
 0.00754926, 0.00752136, 0.00749372, 0.00746635, 0.00743922, 0.00741234,\
 0.00738569, 0.00735928, 0.0073331, 0.00730713, 0.00728138, 0.00721969,\
 0.00715476, 0.00704647, 0.00693178, 0.00682072, 0.00671294, 0.00660812,\
 0.00650599, 0.00640631, 0.00630887, 0.00621999, 0.00613873, 0.00605878,\
 0.00598005, 0.00590248, 0.00582597, 0.00575046, 0.00567589, 0.00560221)\
 CONSTANT NOSPLINE" );
INTERN  VM       VM_Lm  N1:=N_43, N2:=GND  ; 
INTERN  NDSRC    PLm N0:=N_43, N1:=GND  ( QUANT:={N_40.V}, SRC:={vsrc}, TableData:="\
.MODEL Setup1_lm_table pwl TABLE=( 51, 0, 0.105281, 0.210562, 0.315844, 0.4156,\
 0.50302, 0.587148, 0.668417, 0.753373, 0.840378, 0.928412, 1.01484, 1.10052,\
 1.18615, 1.27534, 1.36569, 1.46694, 1.57348, 1.68525, 1.80795, 1.91536,\
 2.02622, 2.13906, 2.27954, 2.4372, 2.62312, 2.82297, 3.05226, 3.31089,\
 3.65819, 4.18217, 5.10269, 6.22726, 7.82513, 9.71848, 12.7004, 17.0037,\
 22.5807, 28.1667, 33.0709, 37.8102, 60.6062, 85.3457, 111.832, 138.534,\
 165.339, 192.125, 218.895, 245.647, 272.412, 299.192, 1, 0.287226, 0.287226,\
 0.287226, 0.287226, 0.291044, 0.300579, 0.309013, 0.316683, 0.32111, 0.323848,\
 0.325711, 0.32777, 0.329728, 0.331418, 0.331953, 0.332135, 0.329824, 0.32671,\
 0.322984, 0.31779, 0.315757, 0.313405, 0.31101, 0.305109, 0.297779, 0.288202,\
 0.27851, 0.267496, 0.255734, 0.239721, 0.216917, 0.183712, 0.155391, 0.127525,\
 0.105792, 0.0833346, 0.0640226, 0.0495493, 0.0407964, 0.0356609, 0.0319908,\
 0.0219538, 0.0170072, 0.0140608, 0.0122238, 0.0109736, 0.0100733, 0.00939392,\
 0.0088633, 0.00843647, 0.00808564) CONSTANT NOSPLINE" );
}

}
