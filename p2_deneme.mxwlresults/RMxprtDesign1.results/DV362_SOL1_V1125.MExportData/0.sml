//         Left: A B C N
//        Right: ROT1 ROT2 Pos

// A           : Phase A
// B           : Phase B
// C           : Phase C
// N           : Neutral
// ROT1        : Mechanical plus
// ROT2        : Mechanical minus
// Pos         : Position

MODELDEF Setup1
{
PORT electrical: A;
PORT electrical: B;
PORT electrical: C;
PORT electrical: N;
PORT ROTATIONAL_V: ROT1;
PORT ROTATIONAL_V: ROT2;
PORT REAL OUT ANGLE[deg]: Pos = VM_Pos.V;
PORT REAL IN ANGLE[deg]: IniPos = 0;

INTERN  R        Ra  N1:=A, N2:=N0_1  ( R:=218.616 ); 
INTERN  R        Rb  N1:=B, N2:=N0_2  ( R:=218.616 ); 
INTERN  R        Rc  N1:=C, N2:=N0_3  ( R:=218.616 ); 
UMODEL Transformation_3To2 AB0 NAP:=N0_1, NAN:=N, NBP:=N0_2, NBN:=N, NCP:=N0_3, NCN:=N, NALPHA:=alpha, NBETA:=beta, NZERO:=zero () SRC: DLL( File:="Transformation.dll");

INTERN  EV       Speed  N1:=NM_1, N2:=GND  ( QUANT:=Torq.V, FACT:=1 ); 
INTERN  II       Torq  N1:=NM_6, N2:=NM_5  ( QUANT:=Speed.I, FACT:=1 ); 
UMODEL D2D D2D1 N1:=NM_5, N2:=ROT1 ( NATURE_1:="electrical", NATURE_2:="Rotational_V" ) SRC: DLL( File:="Domains.dll");
UMODEL D2D D2D2 N1:=NM_6, N2:=ROT2 ( NATURE_1:="electrical", NATURE_2:="Rotational_V" ) SRC: DLL( File:="Domains.dll");
INTERN  VM       VM_Pos  N1:=NM_2, N2:=GND  ; 
MODEL Setup1_AB0 model1 N_1:=alpha, N_2:=beta, N_3:=zero, N_4:=NM_1, N_5:=NM_2 ( pos0:=IniPos );


//         Left: N_1 N_2 N_3
//        Right: N_4 N_5

MODELDEF Setup1_AB0
{
PORT electrical: N_1;
PORT electrical: N_4;
PORT electrical: N_2;
PORT electrical: N_5;
PORT electrical: N_3;
PORT REAL IN: pos0 = 0;

INTERN  L        L1d  N1:=N_1, N2:=N_8  ( L:=N_41.V, I0:=0 ); 
INTERN  L        Lmd  N1:=N_8, N2:=GND  ( L:=N_43.V, I0:=0 ); 
INTERN  R        Rfed  N1:=N_8, N2:=GND  ( R:=4.81391e+008 ); 
INTERN  L        L2d  N1:=N_9, N2:=N_8  ( L:=N_42.V, I0:=0 ); 
INTERN  R        R2d  N1:=N_10, N2:=N_9  ( R:=8.10709 ); 
INTERN  E        B2d  N1:=N_10, N2:=N_11  ( EMF:=2 * N_42.V * N_4.V * L2q.I, PARTDERIV:=1 ); 
INTERN  L        L2td  N1:=N_12, N2:=N_11  ( L:=0.0210685, I0:=0 ); 
INTERN  L        L2bd  N1:=N_13, N2:=N_11  ( L:=0.0556346, I0:=0 ); 
INTERN  M        K2d  ( L1:= L2td.L, L2:= L2bd.L, K:=0.736783 ); 
INTERN  R        R2td  N1:=N_14, N2:=N_12  ( R:=52.8807 ); 
INTERN  R        R2bd  N1:=N_15, N2:=N_13  ( R:=22.6631 ); 
INTERN  E        B2ttd  N1:=N_14, N2:=N_16  ( EMF:=0.042137 * N_4.V * L2tq.I, PARTDERIV:=1 ); 
INTERN  E        B2btd  N1:=N_15, N2:=N_17  ( EMF:=0.0504497 * N_4.V * L2tq.I, PARTDERIV:=1 ); 
INTERN  E        B2tbd  N1:=N_16, N2:=N_18  ( EMF:=0.0504497 * N_4.V * L2bq.I, PARTDERIV:=1 ); 
INTERN  E        B2bbd  N1:=N_17, N2:=N_18  ( EMF:=0.111269 * N_4.V * L2bq.I, PARTDERIV:=1 ); 
INTERN  E        Bmd  N1:=N_18, N2:=GND  ( EMF:=2 * N_43.V * N_4.V * Lmq.I, PARTDERIV:=1 ); 
INTERN  L        L1q  N1:=N_2, N2:=N_28  ( L:=N_41.V, I0:=0 ); 
INTERN  L        Lmq  N1:=N_28, N2:=GND  ( L:=N_43.V, I0:=0 ); 
INTERN  R        Rfeq  N1:=N_28, N2:=GND  ( R:=4.81391e+008 ); 
INTERN  L        L2q  N1:=N_29, N2:=N_28  ( L:=N_42.V, I0:=0 ); 
INTERN  R        R2q  N1:=N_30, N2:=N_29  ( R:=8.10709 ); 
INTERN  E        B2q  N1:=N_30, N2:=N_31  ( EMF:=-2 * N_42.V * N_4.V * L2d.I, PARTDERIV:=1 ); 
INTERN  L        L2tq  N1:=N_32, N2:=N_31  ( L:=0.0210685, I0:=0 ); 
INTERN  L        L2bq  N1:=N_33, N2:=N_31  ( L:=0.0556346, I0:=0 ); 
INTERN  M        K2q  ( L1:= L2tq.L, L2:= L2bq.L, K:=0.736783 ); 
INTERN  R        R2tq  N1:=N_34, N2:=N_32  ( R:=52.8807 ); 
INTERN  R        R2bq  N1:=N_35, N2:=N_33  ( R:=22.6631 ); 
INTERN  E        B2ttq  N1:=N_34, N2:=N_36  ( EMF:=-0.042137 * N_4.V * L2td.I, PARTDERIV:=1 ); 
INTERN  E        B2btq  N1:=N_35, N2:=N_37  ( EMF:=-0.0504497 * N_4.V * L2td.I, PARTDERIV:=1 ); 
INTERN  E        B2tbq  N1:=N_36, N2:=N_38  ( EMF:=-0.0504497 * N_4.V * L2bd.I, PARTDERIV:=1 ); 
INTERN  E        B2bbq  N1:=N_37, N2:=N_38  ( EMF:=-0.111269 * N_4.V * L2bd.I, PARTDERIV:=1 ); 
INTERN  E        Bmq  N1:=N_38, N2:=GND  ( EMF:=-2 * N_43.V * N_4.V * Lmd.I, PARTDERIV:=1 ); 
INTERN  L        L0  N1:=N_3, N2:=GND  ( L:=0.0715615, I0:=0 ); 
INTERN  I        BT  N1:=GND, N2:=N_4  ( IS:=2 * N_43.V * (L2d.I*Lmq.I - L2q.I*Lmd.I), PARTDERIV:=1 ); 
INTERN  VM       VM_Speed  N1:=N_4, N2:=GND  ; 
INTERN  IV       Gx  N1:=GND, N2:=N_55  ( QUANT:=VM_Speed.V, FACT:=1 ); 
INTERN  C        Cx  N1:=N_55, N2:=GND  ( C:=1, V0:=pos0*0.0174533 ); 
INTERN  VM       VM_Pos  N1:=N_55, N2:=GND  ; 
INTERN  EV       Ex2  N1:=GND, N2:=N_5  ( QUANT:=VM_Pos.V, FACT:=57.2958 ); 
INTERN  E        BIsr  N1:=GND, N2:=N_39  ( EMF:=sqrt(L1d.I*L1d.I + L1q.I*L1q.I), PARTDERIV:=1 ); 
INTERN  VM       VM_Isr  N1:=N_39, N2:=GND  ; 
INTERN  E        BIm  N1:=GND, N2:=N_40  ( EMF:=sqrt(Lmd.I*Lmd.I + Lmq.I*Lmq.I), PARTDERIV:=1 ); 
INTERN  VM       VM_Im  N1:=N_40, N2:=GND  ; 
INTERN  VM       VM_L1  N1:=N_41, N2:=GND  ; 
INTERN  NDSRC    PL1 N0:=N_41, N1:=GND  ( QUANT:={N_39.V}, SRC:={vsrc}, TableData:="\
.MODEL Setup1_l1_table pwl TABLE=( 51, 0, 0.0395792, 0.0791583, 0.118738,\
 0.158317, 0.197896, 0.237475, 0.277054, 0.316633, 0.356213, 0.395792,\
 0.435371, 0.47495, 0.514529, 0.554108, 0.593688, 0.633267, 0.672846, 0.712425,\
 0.752004, 0.791583, 0.831163, 0.870742, 0.910321, 0.9499, 0.989479, 1.02906,\
 1.06864, 1.10822, 1.1478, 1.18738, 1.22695, 1.26653, 1.30611, 1.34569,\
 1.38527, 1.42485, 1.46443, 1.50401, 1.54359, 1.58317, 1.62275, 1.66233,\
 1.7019, 1.74148, 1.78106, 1.82064, 1.86022, 1.8998, 1.93938, 1.97896, 1,\
 0.0715877, 0.0715861, 0.0715844, 0.0715828, 0.0715811, 0.0715795, 0.0715778,\
 0.0715762, 0.0715745, 0.0715729, 0.0715712, 0.0715696, 0.0715679, 0.0715663,\
 0.0715646, 0.071563, 0.0715613, 0.0715597, 0.071558, 0.0715564, 0.0715547,\
 0.0715531, 0.0715515, 0.0715498, 0.0715482, 0.0715465, 0.0715449, 0.0715432,\
 0.0715416, 0.07154, 0.0715383, 0.0715367, 0.071535, 0.0715334, 0.0715318,\
 0.0715301, 0.0715285, 0.0715268, 0.0715252, 0.0715236, 0.0715219, 0.0715203,\
 0.0715187, 0.071517, 0.0715154, 0.0715137, 0.0715121, 0.0715105, 0.0715088,\
 0.0715072, 0.0715056) CONSTANT NOSPLINE" );
INTERN  VM       VM_L2  N1:=N_42, N2:=GND  ; 
INTERN  NDSRC    PL2 N0:=N_42, N1:=GND  ( QUANT:={N_39.V}, SRC:={vsrc}, TableData:="\
.MODEL Setup1_l2_table pwl TABLE=( 51, 0, 0.0395792, 0.0791583, 0.118738,\
 0.158317, 0.197896, 0.237475, 0.277054, 0.316633, 0.356213, 0.395792,\
 0.435371, 0.47495, 0.514529, 0.554108, 0.593688, 0.633267, 0.672846, 0.712425,\
 0.752004, 0.791583, 0.831163, 0.870742, 0.910321, 0.9499, 0.989479, 1.02906,\
 1.06864, 1.10822, 1.1478, 1.18738, 1.22695, 1.26653, 1.30611, 1.34569,\
 1.38527, 1.42485, 1.46443, 1.50401, 1.54359, 1.58317, 1.62275, 1.66233,\
 1.7019, 1.74148, 1.78106, 1.82064, 1.86022, 1.8998, 1.93938, 1.97896, 1,\
 0.0594846, 0.0594772, 0.0594699, 0.0594625, 0.0594551, 0.0594478, 0.0594404,\
 0.0594331, 0.0594257, 0.0594184, 0.059411, 0.0594037, 0.0593964, 0.059389,\
 0.0593817, 0.0593744, 0.059367, 0.0593597, 0.0593524, 0.0593451, 0.0593377,\
 0.0593304, 0.0593231, 0.0593158, 0.0593085, 0.0593012, 0.0592939, 0.0592866,\
 0.0592793, 0.059272, 0.0592647, 0.0592574, 0.0592501, 0.0592428, 0.0592356,\
 0.0592283, 0.059221, 0.0592137, 0.0592064, 0.0591992, 0.0591919, 0.0591846,\
 0.0591774, 0.0591701, 0.0591629, 0.0591556, 0.0591484, 0.0591411, 0.0591339,\
 0.0591266, 0.0591194) CONSTANT NOSPLINE" );
INTERN  VM       VM_Lm  N1:=N_43, N2:=GND  ; 
INTERN  NDSRC    PLm N0:=N_43, N1:=GND  ( QUANT:={N_40.V}, SRC:={vsrc}, TableData:="\
.MODEL Setup1_lm_table pwl TABLE=( 51, 0, 0.0201796, 0.0403591, 0.0605387,\
 0.0807183, 0.100898, 0.120993, 0.140203, 0.158201, 0.17574, 0.193063,\
 0.210354, 0.22737, 0.244598, 0.261936, 0.279725, 0.297501, 0.315547, 0.333294,\
 0.35097, 0.368575, 0.386145, 0.403682, 0.421307, 0.439516, 0.457726, 0.475935,\
 0.494144, 0.514304, 0.534662, 0.55501, 0.57535, 0.59632, 0.618589, 0.640787,\
 0.662576, 0.684601, 0.706675, 0.728776, 0.753599, 0.77867, 0.891035, 1.04399,\
 1.23442, 1.63454, 2.49529, 4.30563, 7.48346, 10.2299, 13.3438, 16.598, 1,\
 1.49852, 1.49852, 1.49852, 1.49852, 1.49852, 1.49852, 1.49957, 1.50978,\
 1.52917, 1.54862, 1.5663, 1.5813, 1.59596, 1.60718, 1.61624, 1.62156, 1.62632,\
 1.62914, 1.63312, 1.63703, 1.64088, 1.64453, 1.648, 1.65083, 1.65124, 1.65161,\
 1.65196, 1.65228, 1.64631, 1.64018, 1.63454, 1.62931, 1.62272, 1.61319,\
 1.6045, 1.59737, 1.59015, 1.58327, 1.57675, 1.56494, 1.55339, 1.49325,\
 1.39033, 1.27384, 1.03601, 0.727116, 0.449487, 0.274777, 0.212831, 0.17223,\
 0.14575) CONSTANT NOSPLINE" );
}

}
