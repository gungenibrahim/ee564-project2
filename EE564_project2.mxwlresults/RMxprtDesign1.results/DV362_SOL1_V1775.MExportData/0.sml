//         Left: A B C N
//        Right: ROT1 ROT2 Pos

// A           : Phase A
// B           : Phase B
// C           : Phase C
// N           : Neutral
// ROT1        : Mechanical plus
// ROT2        : Mechanical minus
// Pos         : Position

MODELDEF Setup1
{
PORT electrical: A;
PORT electrical: B;
PORT electrical: C;
PORT electrical: N;
PORT ROTATIONAL_V: ROT1;
PORT ROTATIONAL_V: ROT2;
PORT REAL OUT ANGLE[deg]: Pos = VM_Pos.V;
PORT REAL IN ANGLE[deg]: IniPos = 0;

INTERN  R        Ra  N1:=A, N2:=N0_1  ( R:=32.1938 ); 
INTERN  R        Rb  N1:=B, N2:=N0_2  ( R:=32.1938 ); 
INTERN  R        Rc  N1:=C, N2:=N0_3  ( R:=32.1938 ); 
UMODEL Transformation_3To2 AB0 NAP:=N0_1, NAN:=N, NBP:=N0_2, NBN:=N, NCP:=N0_3, NCN:=N, NALPHA:=alpha, NBETA:=beta, NZERO:=zero () SRC: DLL( File:="Transformation.dll");

INTERN  EV       Speed  N1:=NM_1, N2:=GND  ( QUANT:=Torq.V, FACT:=1 ); 
INTERN  II       Torq  N1:=NM_6, N2:=NM_5  ( QUANT:=Speed.I, FACT:=1 ); 
UMODEL D2D D2D1 N1:=NM_5, N2:=ROT1 ( NATURE_1:="electrical", NATURE_2:="Rotational_V" ) SRC: DLL( File:="Domains.dll");
UMODEL D2D D2D2 N1:=NM_6, N2:=ROT2 ( NATURE_1:="electrical", NATURE_2:="Rotational_V" ) SRC: DLL( File:="Domains.dll");
INTERN  VM       VM_Pos  N1:=NM_2, N2:=GND  ; 
MODEL Setup1_AB0 model1 N_1:=alpha, N_2:=beta, N_3:=zero, N_4:=NM_1, N_5:=NM_2 ( pos0:=IniPos );


//         Left: N_1 N_2 N_3
//        Right: N_4 N_5

MODELDEF Setup1_AB0
{
PORT electrical: N_1;
PORT electrical: N_4;
PORT electrical: N_2;
PORT electrical: N_5;
PORT electrical: N_3;
PORT REAL IN: pos0 = 0;

INTERN  L        L1d  N1:=N_1, N2:=N_8  ( L:=N_41.V, I0:=0 ); 
INTERN  L        Lmd  N1:=N_8, N2:=GND  ( L:=N_43.V, I0:=0 ); 
INTERN  R        Rfed  N1:=N_8, N2:=GND  ( R:=4.80103e+008 ); 
INTERN  L        L2d  N1:=N_9, N2:=N_8  ( L:=N_42.V, I0:=0 ); 
INTERN  R        R2d  N1:=N_10, N2:=N_9  ( R:=8.02681 ); 
INTERN  E        B2d  N1:=N_10, N2:=N_11  ( EMF:=2 * N_42.V * N_4.V * L2q.I, PARTDERIV:=1 ); 
INTERN  L        L2td  N1:=N_12, N2:=N_11  ( L:=0.0208383, I0:=0 ); 
INTERN  L        L2bd  N1:=N_13, N2:=N_11  ( L:=0.0550267, I0:=0 ); 
INTERN  M        K2d  ( L1:= L2td.L, L2:= L2bd.L, K:=0.736783 ); 
INTERN  R        R2td  N1:=N_14, N2:=N_12  ( R:=52.1981 ); 
INTERN  R        R2bd  N1:=N_15, N2:=N_13  ( R:=22.3705 ); 
INTERN  E        B2ttd  N1:=N_14, N2:=N_16  ( EMF:=0.0416766 * N_4.V * L2tq.I, PARTDERIV:=1 ); 
INTERN  E        B2btd  N1:=N_15, N2:=N_17  ( EMF:=0.0498985 * N_4.V * L2tq.I, PARTDERIV:=1 ); 
INTERN  E        B2tbd  N1:=N_16, N2:=N_18  ( EMF:=0.0498985 * N_4.V * L2bq.I, PARTDERIV:=1 ); 
INTERN  E        B2bbd  N1:=N_17, N2:=N_18  ( EMF:=0.110053 * N_4.V * L2bq.I, PARTDERIV:=1 ); 
INTERN  E        Bmd  N1:=N_18, N2:=GND  ( EMF:=2 * N_43.V * N_4.V * Lmq.I, PARTDERIV:=1 ); 
INTERN  L        L1q  N1:=N_2, N2:=N_28  ( L:=N_41.V, I0:=0 ); 
INTERN  L        Lmq  N1:=N_28, N2:=GND  ( L:=N_43.V, I0:=0 ); 
INTERN  R        Rfeq  N1:=N_28, N2:=GND  ( R:=4.80103e+008 ); 
INTERN  L        L2q  N1:=N_29, N2:=N_28  ( L:=N_42.V, I0:=0 ); 
INTERN  R        R2q  N1:=N_30, N2:=N_29  ( R:=8.02681 ); 
INTERN  E        B2q  N1:=N_30, N2:=N_31  ( EMF:=-2 * N_42.V * N_4.V * L2d.I, PARTDERIV:=1 ); 
INTERN  L        L2tq  N1:=N_32, N2:=N_31  ( L:=0.0208383, I0:=0 ); 
INTERN  L        L2bq  N1:=N_33, N2:=N_31  ( L:=0.0550267, I0:=0 ); 
INTERN  M        K2q  ( L1:= L2tq.L, L2:= L2bq.L, K:=0.736783 ); 
INTERN  R        R2tq  N1:=N_34, N2:=N_32  ( R:=52.1981 ); 
INTERN  R        R2bq  N1:=N_35, N2:=N_33  ( R:=22.3705 ); 
INTERN  E        B2ttq  N1:=N_34, N2:=N_36  ( EMF:=-0.0416766 * N_4.V * L2td.I, PARTDERIV:=1 ); 
INTERN  E        B2btq  N1:=N_35, N2:=N_37  ( EMF:=-0.0498985 * N_4.V * L2td.I, PARTDERIV:=1 ); 
INTERN  E        B2tbq  N1:=N_36, N2:=N_38  ( EMF:=-0.0498985 * N_4.V * L2bd.I, PARTDERIV:=1 ); 
INTERN  E        B2bbq  N1:=N_37, N2:=N_38  ( EMF:=-0.110053 * N_4.V * L2bd.I, PARTDERIV:=1 ); 
INTERN  E        Bmq  N1:=N_38, N2:=GND  ( EMF:=-2 * N_43.V * N_4.V * Lmd.I, PARTDERIV:=1 ); 
INTERN  L        L0  N1:=N_3, N2:=GND  ( L:=0.0578622, I0:=0 ); 
INTERN  I        BT  N1:=GND, N2:=N_4  ( IS:=2 * N_43.V * (L2d.I*Lmq.I - L2q.I*Lmd.I), PARTDERIV:=1 ); 
INTERN  VM       VM_Speed  N1:=N_4, N2:=GND  ; 
INTERN  IV       Gx  N1:=GND, N2:=N_55  ( QUANT:=VM_Speed.V, FACT:=1 ); 
INTERN  C        Cx  N1:=N_55, N2:=GND  ( C:=1, V0:=pos0*0.0174533 ); 
INTERN  VM       VM_Pos  N1:=N_55, N2:=GND  ; 
INTERN  EV       Ex2  N1:=GND, N2:=N_5  ( QUANT:=VM_Pos.V, FACT:=57.2958 ); 
INTERN  E        BIsr  N1:=GND, N2:=N_39  ( EMF:=sqrt(L1d.I*L1d.I + L1q.I*L1q.I), PARTDERIV:=1 ); 
INTERN  VM       VM_Isr  N1:=N_39, N2:=GND  ; 
INTERN  E        BIm  N1:=GND, N2:=N_40  ( EMF:=sqrt(Lmd.I*Lmd.I + Lmq.I*Lmq.I), PARTDERIV:=1 ); 
INTERN  VM       VM_Im  N1:=N_40, N2:=GND  ; 
INTERN  VM       VM_L1  N1:=N_41, N2:=GND  ; 
INTERN  NDSRC    PL1 N0:=N_41, N1:=GND  ( QUANT:={N_39.V}, SRC:={vsrc}, TableData:="\
.MODEL Setup1_l1_table pwl TABLE=( 51, 0, 0.173162, 0.346325, 0.519487,\
 0.692649, 0.865812, 1.03897, 1.21214, 1.3853, 1.55846, 1.73162, 1.90479,\
 2.07795, 2.25111, 2.42427, 2.59744, 2.7706, 2.94376, 3.11692, 3.29009,\
 3.46325, 3.63641, 3.80957, 3.98273, 4.1559, 4.32906, 4.50222, 4.67538,\
 4.84855, 5.02171, 5.19487, 5.36803, 5.5412, 5.71436, 5.88752, 6.06068,\
 6.23385, 6.40701, 6.58017, 6.75333, 6.92649, 7.09966, 7.27282, 7.44598,\
 7.61914, 7.79231, 7.96547, 8.13863, 8.31179, 8.48496, 8.65812, 1, 0.0578973,\
 0.0578892, 0.0578812, 0.0578732, 0.0578651, 0.0578571, 0.0578491, 0.0578411,\
 0.0578331, 0.0578251, 0.0578171, 0.0578091, 0.0578012, 0.0577932, 0.0577851,\
 0.0577692, 0.0577534, 0.0577375, 0.0577218, 0.057706, 0.0576903, 0.0576746,\
 0.0576589, 0.0576433, 0.0576277, 0.0576121, 0.0575965, 0.057581, 0.0575648,\
 0.0575293, 0.0574939, 0.0574587, 0.0574237, 0.0573888, 0.0573541, 0.0573195,\
 0.057285, 0.0572507, 0.0572165, 0.0571825, 0.0571486, 0.0571149, 0.0570782,\
 0.0569912, 0.0569052, 0.0568007, 0.0566436, 0.0564895, 0.0563381, 0.0561895,\
 0.0560433) CONSTANT NOSPLINE" );
INTERN  VM       VM_L2  N1:=N_42, N2:=GND  ; 
INTERN  NDSRC    PL2 N0:=N_42, N1:=GND  ( QUANT:={N_39.V}, SRC:={vsrc}, TableData:="\
.MODEL Setup1_l2_table pwl TABLE=( 51, 0, 0.173162, 0.346325, 0.519487,\
 0.692649, 0.865812, 1.03897, 1.21214, 1.3853, 1.55846, 1.73162, 1.90479,\
 2.07795, 2.25111, 2.42427, 2.59744, 2.7706, 2.94376, 3.11692, 3.29009,\
 3.46325, 3.63641, 3.80957, 3.98273, 4.1559, 4.32906, 4.50222, 4.67538,\
 4.84855, 5.02171, 5.19487, 5.36803, 5.5412, 5.71436, 5.88752, 6.06068,\
 6.23385, 6.40701, 6.58017, 6.75333, 6.92649, 7.09966, 7.27282, 7.44598,\
 7.61914, 7.79231, 7.96547, 8.13863, 8.31179, 8.48496, 8.65812, 1, 0.0505111,\
 0.0504787, 0.0504463, 0.0504141, 0.0503818, 0.0503497, 0.0503176, 0.0502855,\
 0.0502536, 0.0502216, 0.0501898, 0.050158, 0.0501262, 0.0500945, 0.0500623,\
 0.0499992, 0.0499363, 0.0498737, 0.0498113, 0.0497491, 0.0496871, 0.0496254,\
 0.0495639, 0.0495025, 0.0494414, 0.0493805, 0.0493199, 0.0492594, 0.0491962,\
 0.0490583, 0.0489216, 0.0487859, 0.0486512, 0.0485175, 0.0483848, 0.048253,\
 0.0481222, 0.0479923, 0.0478634, 0.0477353, 0.0476081, 0.0474818, 0.0473449,\
 0.0470217, 0.0467038, 0.0463206, 0.0457495, 0.0451944, 0.0446538, 0.0441269,\
 0.0436125) CONSTANT NOSPLINE" );
INTERN  VM       VM_Lm  N1:=N_43, N2:=GND  ; 
INTERN  NDSRC    PLm N0:=N_43, N1:=GND  ( QUANT:={N_40.V}, SRC:={vsrc}, TableData:="\
.MODEL Setup1_lm_table pwl TABLE=( 51, 0, 0.0192725, 0.038545, 0.0578175,\
 0.0770901, 0.0963626, 0.115574, 0.133867, 0.150913, 0.167533, 0.183941,\
 0.200307, 0.216375, 0.232658, 0.249081, 0.265959, 0.282858, 0.299984,\
 0.316806, 0.333565, 0.350225, 0.366876, 0.383496, 0.400175, 0.417424,\
 0.434713, 0.452002, 0.46929, 0.48843, 0.507867, 0.527297, 0.546852, 0.566962,\
 0.58839, 0.60974, 0.630479, 0.651234, 0.672624, 0.693752, 0.71685, 0.740962,\
 0.849014, 0.996044, 1.18161, 1.58425, 2.43815, 4.22699, 7.41127, 10.1516,\
 13.3065, 16.5544, 1, 1.56904, 1.56904, 1.56904, 1.56904, 1.56904, 1.56904,\
 1.56988, 1.58124, 1.60301, 1.62448, 1.64398, 1.66062, 1.67706, 1.68966,\
 1.69966, 1.70549, 1.71051, 1.71366, 1.71812, 1.72245, 1.72686, 1.73091,\
 1.73474, 1.73801, 1.73863, 1.73905, 1.73943, 1.73979, 1.73352, 1.72672,\
 1.72044, 1.71422, 1.70675, 1.69599, 1.6862, 1.67869, 1.67163, 1.66342,\
 1.65635, 1.64517, 1.63244, 1.56715, 1.45726, 1.33077, 1.0689, 0.744157,\
 0.457849, 0.277453, 0.214472, 0.172712, 0.146133) CONSTANT NOSPLINE" );
}

}
